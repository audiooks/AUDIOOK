<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AUDIOOK Player</title>
<style>
    body {
        background-color: #121212;
        color: #fff;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    header {
        background-color: #1e1e1e;
        padding: 10px;
    }
    header img {
        max-height: 60px;
    }
    .player-container {
        max-width: 400px;
        margin: 20px auto;
        padding: 15px;
        background-color: #1e1e1e;
        border-radius: 15px;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .cover img {
        width: 100%;
        border-radius: 10px;
    }
    .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 10px;
    }
    .controls button {
        background-color: #a0522d;
        border: none;
        color: white;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
    }
    .controls button:hover {
        background-color: #8b4513;
    }
    audio {
        width: 100%;
        margin-top: 10px;
    }
    audio::-webkit-media-controls-download-button {
        display: none !important;
    }
    audio::-webkit-media-controls-enclosure {
        overflow: hidden;
    }
    .captions {
        background-color: #222;
        border-radius: 10px;
        padding: 10px;
        margin-top: 15px;
        text-align: left;
        font-size: 14px;
        min-height: 50px;
    }
</style>
</head>
<body>

<header>
    <img src="Untitled design.png" alt="AUDIOOK Logo">
</header>

<div class="player-container">
    <div class="cover">
        <img id="coverImage" src="" alt="Cover">
    </div>
    <div class="controls">
        <button onclick="prevTrack()">⏮</button>
        <button onclick="seekBackward()">⏪ 10s</button>
        <button onclick="togglePlay()">▶️/⏸</button>
        <button onclick="seekForward()">10s ⏩</button>
        <button onclick="nextTrack()">⏭</button>
    </div>
    <audio id="audioPlayer" controls></audio>
    <div class="captions" id="captionBox">Captions will appear here...</div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQqZ4QkKxAGZsmQbi5XrWZiSFuzakxwJJvPabUjJ9su8rRNYe3pxz9R7VTmxpvFXHCsuOZqLbVtzZHZ/pub?gid=892865560&single=true&output=csv";

let playlist = [];
let currentTrack = 0;
let audio = document.getElementById("audioPlayer");
let captionBox = document.getElementById("captionBox");
let coverImage = document.getElementById("coverImage");
let captions = [];

// Load CSV
fetch(CSV_URL)
    .then(res => res.text())
    .then(data => {
        let rows = data.split("\n").map(r => r.split(","));
        rows.shift(); // remove header
        playlist = rows.map(r => ({
            title: r[0],
            image: r[1],
            audio: r[2],
            caption: r[3]
        }));
        loadTrack(currentTrack);
    });

function loadTrack(index) {
    let track = playlist[index];
    coverImage.src = track.image;
    audio.src = track.audio;
    loadCaptions(track.caption);
}

function togglePlay() {
    if (audio.paused) {
        audio.play();
    } else {
        audio.pause();
    }
}

function seekForward() {
    audio.currentTime += 10;
}

function seekBackward() {
    audio.currentTime -= 10;
}

function nextTrack() {
    currentTrack = (currentTrack + 1) % playlist.length;
    loadTrack(currentTrack);
    audio.play();
}

function prevTrack() {
    currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
    loadTrack(currentTrack);
    audio.play();
}

function loadCaptions(url) {
    fetch(url)
        .then(res => res.text())
        .then(vtt => {
            captions = parseVTT(vtt);
        });
}

function parseVTT(data) {
    let cues = [];
    let lines = data.split("\n");
    let cue = {};
    lines.forEach(line => {
        if (line.includes("-->")) {
            let times = line.split(" --> ");
            cue.start = toSeconds(times[0]);
            cue.end = toSeconds(times[1]);
        } else if (line.trim() === "") {
            if (cue.text) {
                cues.push(cue);
                cue = {};
            }
        } else {
            cue.text = line;
        }
    });
    return cues;
}

function toSeconds(t) {
    let p = t.split(":");
    let s = p.pop();
    let m = p.pop();
    let h = p.length ? p.pop() : 0;
    return parseFloat(s) + (m * 60) + (h * 3600);
}

audio.addEventListener("timeupdate", () => {
    let current = audio.currentTime;
    let activeCue = captions.find(c => current >= c.start && current <= c.end);
    captionBox.textContent = activeCue ? activeCue.text : "";
});
</script>

</body>
  </html>
