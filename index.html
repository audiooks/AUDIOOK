<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AUDIOOKS Player</title>
<style>
  :root {
    --bg: #0b0f14; 
    --muted: #a4b0bd; 
    --accent: #b87333; /* brown accent */
  }
  html,body{
    height:100%;
    margin:0;
    font-family:Inter,system-ui,Arial; 
    background:linear-gradient(180deg,#081018 0%, #071923 100%);
    color:#e6eef8;
  }
  .wrap{
    max-width:920px;
    margin:18px auto;
    padding:18px;
    text-align:center;
  }
  .logo{
    width:100px;
    height:auto;
    margin:0 auto 8px;
  }
  .appname{
    font-size:28px;
    font-weight:800;
    color:var(--accent);
    margin-bottom:18px;
  }
  .card{
    background:rgba(255,255,255,0.02);
    border-radius:12px;
    padding:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.5);
  }
  .top{
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:center;
    flex-direction:column;
  }
  .art{
    width:220px;
    height:220px;
    border-radius:12px;
    overflow:hidden;
    background:linear-gradient(135deg,var(--accent),#6e4933);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:42px;
    color:white;
  }
  .controls{
    display:flex;
    gap:12px;
    align-items:center;
    margin-top:18px;
    justify-content:center;
  }
  .btn{
    background:transparent;
    border:0;
    color:#e6eef8;
    padding:10px;
    border-radius:10px;
    font-size:20px;
    cursor:pointer;
  }
  .playbig{
    width:78px;
    height:78px;
    border-radius:50%;
    display:grid;
    place-items:center;
    background:rgba(255,255,255,0.03);
    font-size:28px;
    box-shadow:0 6px 20px rgba(0,0,0,.5);
  }
  .seek{
    display:flex;
    align-items:center;
    gap:12px;
    margin-top:12px;
  }
  input[type=range]{
    flex:1;
  }
  .time{
    width:56px;
    text-align:center;
    color:var(--muted);
    font-size:13px;
  }
  .caption-box{
    margin-top:14px;
    padding:10px;
    border-radius:8px;
    background:rgba(255,255,255,0.03);
    font-weight:600;
    min-height:36px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <img class="logo" src="https://archive.org/download/img-20250811-wa-0028/IMG-20250811-WA0028.png" alt="Logo">
    <div class="appname">AUDIOOKS</div>

    <div class="card" id="playerCard">
      <div class="top">
        <div class="art" id="artEl">A</div>
        <div class="controls">
          <button class="btn" id="prevBtn" title="Previous">⏮</button>
          <button class="btn" id="rewindBtn" title="Rewind 10s">⏪</button>
          <button class="playbig" id="playBtn" title="Play">▶️</button>
          <button class="btn" id="forwardBtn" title="Forward 10s">⏩</button>
          <button class="btn" id="nextBtn" title="Next">⏭</button>
          <button class="btn" id="ccBtn" title="Toggle captions">CC</button>
        </div>
        <div class="seek">
          <div class="time" id="curTime">0:00</div>
          <input id="seek" type="range" min="0" max="100" step="0.01" value="0" />
          <div class="time" id="durTime">0:00</div>
        </div>
      </div>

      <div class="caption-box" id="captionBox">Captions will appear here</div>

      <audio id="audio" crossorigin="anonymous"></audio>
    </div>
  </div>

<script>
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const rewindBtn = document.getElementById('rewindBtn');
const forwardBtn = document.getElementById('forwardBtn');
const ccBtn = document.getElementById('ccBtn');
const seek = document.getElementById('seek');
const curTime = document.getElementById('curTime');
const durTime = document.getElementById('durTime');
const artEl = document.getElementById('artEl');
const captionBox = document.getElementById('captionBox');

let captionsOn = true;
let transcript = [];

function getParam(name){
  return new URLSearchParams(location.search).get(name);
}

async function loadVTT(url){
  try {
    const res = await fetch(url);
    const txt = await res.text();
    return parseVTT(txt);
  } catch(e){
    console.warn('Could not load VTT', e);
    return [];
  }
}

function parseVTT(vttText){
  const lines = vttText.replace(/\r/g,'').split('\n');
  const cues = [];
  let i = 0;
  while (i < lines.length){
    const line = lines[i].trim();
    if (!line) { i++; continue; }
    const timecodePattern = /^(?:\d{2}:)?\d{2}:\d{2}\.\d{3}\s*-->\s*(?:\d{2}:)?\d{2}:\d{2}\.\d{3}/;
    if (timecodePattern.test(line)){
      const [startStr, endStr] = line.split('-->').map(s=>s.trim());
      const start = timeToSeconds(startStr);
      const end = timeToSeconds(endStr);
      i++;
      let textLines = [];
      while (i < lines.length && lines[i].trim()){
        textLines.push(lines[i]);
        i++;
      }
      cues.push({start, end, text: textLines.join('\n')});
    } else { i++; }
  }
  return cues;
}

function timeToSeconds(t){
  const parts = t.split(':').map(p=>p.replace(',', '.'));
  let sec = 0;
  if (parts.length === 3){
    sec = (+parts[0])*3600 + (+parts[1])*60 + (+parts[2]);
  } else if (parts.length === 2){
    sec = (+parts[0])*60 + (+parts[1]);
  } else sec = +parts[0];
  return sec;
}

function formatTime(s){
  s = Math.floor(s);
  const m = Math.floor(s/60);
  const sec = (s%60).toString().padStart(2,'0');
  return `${m}:${sec}`;
}

function updateCaptions(){
  const t = audio.currentTime;
  let active = transcript.find(c => t >= c.start && t < c.end);
  captionBox.textContent = active && captionsOn ? active.text : '';
}

playBtn.addEventListener('click', ()=> audio.paused ? audio.play() : audio.pause());
rewindBtn.addEventListener('click', ()=> audio.currentTime = Math.max(0, audio.currentTime - 10));
forwardBtn.addEventListener('click', ()=> audio.currentTime = Math.min(audio.duration, audio.currentTime + 10));
ccBtn.addEventListener('click', ()=> captionsOn = !captionsOn);

seek.addEventListener('input', ()=> curTime.textContent = formatTime(seek.value));
seek.addEventListener('change', ()=> audio.currentTime = seek.value);

audio.addEventListener('loadedmetadata', ()=>{
  seek.max = audio.duration;
  durTime.textContent = formatTime(audio.duration);
});
audio.addEventListener('play', ()=> playBtn.textContent = '⏸');
audio.addEventListener('pause', ()=> playBtn.textContent = '▶️');
audio.addEventListener('timeupdate', ()=>{
  seek.value = audio.currentTime;
  curTime.textContent = formatTime(audio.currentTime);
  updateCaptions();
});

(async function init(){
  const audioUrl = getParam('audio');
  const imgUrl = getParam('image');
  const captionsUrl = getParam('captions');
  
  if (audioUrl) audio.src = audioUrl;
  if (imgUrl) artEl.innerHTML = `<img src="${imgUrl}" style="width:100%;height:100%;object-fit:cover" alt="art">`;
  if (captionsUrl) transcript = await loadVTT(captionsUrl);
})();
</script>
</body>
  </html>
